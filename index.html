<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>donutmarket.pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
:root{
  --font:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue",Arial,sans-serif;
  --mono:"SF Mono",ui-monospace,"Cascadia Mono",monospace;
  --bg-a:#060810;--bg-b:#0a0d18;--bg-c:#0e1220;
  --orb1:rgba(59,130,246,.2);--orb2:rgba(99,102,241,.16);--orb3:rgba(168,85,247,.1);
  --gb:rgba(255,255,255,.065);--gb-h:rgba(255,255,255,.1);
  --gbr:rgba(255,255,255,.13);--gbr-s:rgba(255,255,255,.22);
  --shine:rgba(255,255,255,.16);--blur:22px;
  --t1:rgba(255,255,255,.95);--t2:rgba(255,255,255,.54);--t3:rgba(255,255,255,.26);
  --accent:#3b82f6;--accent2:#6366f1;--aa:rgba(59,130,246,.22);--ab:rgba(59,130,246,.38);
  --green:#34d399;--ga:rgba(52,211,153,.18);
  --red:#f87171;--ra:rgba(248,113,113,.18);
  --gold:#fbbf24;--goa:rgba(251,191,36,.18);
  --shadow:0 8px 32px rgba(0,0,0,.45),0 2px 8px rgba(0,0,0,.3);
  --mshadow:0 40px 100px rgba(0,0,0,.7),0 8px 32px rgba(0,0,0,.4);
  --r:16px;--rsm:10px;
}
[data-theme="light"]{
  --bg-a:#dfe8f5;--bg-b:#d4e0f0;--bg-c:#c8d6eb;
  --orb1:rgba(59,130,246,.14);--orb2:rgba(99,102,241,.1);--orb3:rgba(168,85,247,.08);
  --gb:rgba(255,255,255,.58);--gb-h:rgba(255,255,255,.75);
  --gbr:rgba(255,255,255,.78);--gbr-s:rgba(255,255,255,.92);
  --shine:rgba(255,255,255,.88);
  --t1:rgba(10,18,40,.92);--t2:rgba(10,18,40,.52);--t3:rgba(10,18,40,.26);
  --accent:#2563eb;--accent2:#4f46e5;--aa:rgba(37,99,235,.12);--ab:rgba(37,99,235,.32);
  --green:#059669;--ga:rgba(5,150,105,.12);
  --red:#dc2626;--ra:rgba(220,38,38,.1);
  --gold:#d97706;--goa:rgba(217,119,6,.12);
  --shadow:0 8px 32px rgba(20,50,120,.1),0 2px 8px rgba(20,50,120,.07);
  --mshadow:0 40px 100px rgba(20,50,120,.22),0 8px 32px rgba(20,50,120,.12);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:var(--font);background:var(--bg-a);color:var(--t1);overflow-x:hidden;
  -webkit-font-smoothing:antialiased;transition:background .5s,color .3s}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:var(--gbr);border-radius:2px}

/* ‚îÄ‚îÄ ORBS ‚îÄ‚îÄ */
.orb{position:fixed;border-radius:50%;pointer-events:none;z-index:0;filter:blur(80px);opacity:0}
.o1{width:700px;height:600px;top:-180px;left:-180px;background:var(--orb1);animation:od1 18s ease-in-out infinite}
.o2{width:600px;height:700px;top:25%;right:-140px;background:var(--orb2);animation:od2 22s ease-in-out infinite}
.o3{width:500px;height:500px;bottom:-80px;left:32%;background:var(--orb3);animation:od3 26s ease-in-out infinite}
@keyframes od1{0%,100%{transform:translate(0,0) scale(1)}40%{transform:translate(110px,70px) scale(1.08)}70%{transform:translate(-50px,130px) scale(.95)}}
@keyframes od2{0%,100%{transform:translate(0,0)}40%{transform:translate(-90px,-70px) scale(1.06)}70%{transform:translate(70px,50px) scale(.93)}}
@keyframes od3{0%,100%{transform:translate(0,0)}50%{transform:translate(-70px,-50px) scale(1.1)}}

/* ‚îÄ‚îÄ GLASS ‚îÄ‚îÄ */
.g{background:var(--gb);backdrop-filter:blur(var(--blur)) saturate(1.8);
  -webkit-backdrop-filter:blur(var(--blur)) saturate(1.8);
  border:1px solid var(--gbr);position:relative;overflow:hidden}
.g::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--shine) 30%,var(--shine) 70%,transparent);
  pointer-events:none;z-index:1}
.g::after{content:'';position:absolute;top:0;left:-100%;width:55%;height:100%;
  background:linear-gradient(105deg,transparent 40%,rgba(255,255,255,.035) 50%,transparent 60%);
  pointer-events:none;z-index:1;transition:left .7s ease}
.g:hover::after{left:150%}

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
#nav{position:fixed;top:0;left:0;right:0;z-index:900;padding:10px 20px}
.np{max-width:1320px;margin:0 auto;display:flex;align-items:center;gap:12px;
  padding:8px 16px;border-radius:50px;box-shadow:0 8px 32px rgba(0,0,0,.3),0 1px 0 var(--shine) inset}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;flex-shrink:0}
.lgem{width:28px;height:28px;border-radius:7px;background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0;
  box-shadow:0 0 14px var(--aa);transition:transform .3s cubic-bezier(.34,1.56,.64,1)}
.lgem:hover{transform:scale(1.1) rotate(-5deg)}
.lgem img{width:20px;height:20px;image-rendering:crisp-edges}
.ltxt{font-size:.88rem;font-weight:700;letter-spacing:-.03em;color:var(--t1)}
.ltxt b{color:var(--accent)}
.ns{flex:1;max-width:300px;position:relative}
.ns svg{position:absolute;left:11px;top:50%;transform:translateY(-50%);color:var(--t3);pointer-events:none}
#srch{width:100%;background:var(--gb);border:1px solid var(--gbr);border-radius:50px;
  padding:7px 12px 7px 32px;color:var(--t1);font-family:var(--font);font-size:.83rem;
  outline:none;backdrop-filter:blur(10px);transition:all .2s}
#srch::placeholder{color:var(--t3)}
#srch:focus{border-color:var(--ab);box-shadow:0 0 0 3px var(--aa)}
.nav-btns{display:flex;align-items:center;gap:6px;margin-left:auto}
.nbtn{display:flex;align-items:center;gap:5px;background:var(--gb);border:1px solid var(--gbr);
  border-radius:50px;padding:5px 12px;font-size:.74rem;font-weight:500;color:var(--t2);
  cursor:pointer;transition:all .2s;white-space:nowrap}
.nbtn:hover{background:var(--gb-h);color:var(--t1);border-color:var(--gbr-s)}
.nbtn.admin-btn{color:var(--gold);border-color:var(--goa)}
.tgl{width:38px;height:22px;border-radius:50px;background:var(--gb);border:1px solid var(--gbr);
  position:relative;cursor:pointer;transition:all .25s;flex-shrink:0}
.tgl::before{content:'';position:absolute;width:14px;height:14px;border-radius:50%;
  background:var(--accent);top:3px;left:3px;
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);box-shadow:0 1px 4px rgba(0,0,0,.3)}
[data-theme="light"] .tgl::before{transform:translateX(16px);background:var(--gold)}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero{position:relative;z-index:1;max-width:1320px;margin:0 auto;padding:100px 28px 28px}
.hero-title{font-size:clamp(1.9rem,3.2vw,2.9rem);font-weight:800;letter-spacing:-.05em;line-height:1.08;
  background:linear-gradient(135deg,var(--t1) 0%,rgba(255,255,255,.6) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent}
[data-theme="light"] .hero-title{background:linear-gradient(135deg,var(--t1) 0%,rgba(10,18,40,.5) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero-title em{font-style:normal;background:linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent}

/* ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ */
.content{position:relative;z-index:1;max-width:1320px;margin:0 auto;padding:16px 28px 120px}
.sec-hdr{display:flex;align-items:center;gap:10px;margin:40px 0 13px;
  padding-bottom:11px;border-bottom:1px solid var(--gbr);opacity:0;transform:translateY(10px)}
.sec-hdr:first-child{margin-top:0}
.sec-name{font-size:.9rem;font-weight:700;letter-spacing:-.02em;color:var(--t1)}
.sec-ct{font-size:.64rem;font-family:var(--mono);color:var(--t3);background:var(--gb);
  border:1px solid var(--gbr);border-radius:50px;padding:2px 8px;margin-left:auto}

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(178px,1fr));gap:9px}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{border-radius:var(--r);padding:13px 13px 11px;cursor:pointer;
  opacity:0;transform:translateY(18px) scale(.98);will-change:transform,opacity;
  box-shadow:var(--shadow);
  transition:border-color .18s ease,box-shadow .28s ease,transform .28s cubic-bezier(.34,1.4,.64,1)}
.card:hover{border-color:var(--ab)!important;
  box-shadow:0 16px 48px rgba(59,130,246,.14),0 4px 16px rgba(0,0,0,.3),0 0 0 1px var(--ab);
  transform:translateY(-4px) scale(1.018)!important}
.card:active{transform:translateY(-1px) scale(1.008)!important}
.ctop{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.cimg{width:42px;height:42px;border-radius:9px;background:var(--gb);border:1px solid var(--gbr);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.18) inset}
.cimg img{width:32px;height:32px;image-rendering:crisp-edges;object-fit:contain;
  display:block;transition:transform .32s cubic-bezier(.34,1.56,.64,1)}
.card:hover .cimg img{transform:scale(1.2) rotate(-5deg)}
.cname{font-size:.8rem;font-weight:600;letter-spacing:-.012em;line-height:1.3;
  color:var(--t1);word-break:break-word}
.cid{font-size:.6rem;font-family:var(--mono);color:var(--t3);margin-top:1px;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cprice{font-size:1.06rem;font-weight:700;font-family:var(--mono);color:var(--t1);
  letter-spacing:-.022em;line-height:1}
.sp-wrap{height:30px;margin:9px 0 6px;position:relative}
.sp-wrap canvas{position:absolute;inset:0;width:100%!important;height:30px!important}
.cbot{display:flex;align-items:center;justify-content:space-between}
.cchg{display:inline-flex;align-items:center;gap:3px;font-size:.67rem;font-weight:600;
  font-family:var(--mono);padding:2px 7px;border-radius:50px;border:1px solid}
.cchg.up{background:var(--ga);color:var(--green);border-color:rgba(52,211,153,.28)}
.cchg.dn{background:var(--ra);color:var(--red);border-color:rgba(248,113,113,.28)}
.cchg.fl{background:var(--gb);color:var(--t3);border-color:var(--gbr)}
.csrc{display:flex;gap:3px}
.spill{font-size:.58rem;font-weight:600;font-family:var(--mono);padding:2px 6px;border-radius:50px;border:1px solid}
.spill.a{color:var(--gold);border-color:rgba(251,191,36,.3);background:var(--goa)}
.spill.o{color:var(--accent);border-color:var(--ab);background:var(--aa)}
.spill.e{color:var(--t3);border-color:var(--gbr);background:var(--gb)}

/* ‚îÄ‚îÄ MODAL BACKDROP ‚îÄ‚îÄ */
#mbg{position:fixed;inset:0;z-index:980;display:none;align-items:center;justify-content:center;padding:16px}
#mbg.open{display:flex}
.mbg-bl{position:absolute;inset:0;background:rgba(0,0,0,0);backdrop-filter:blur(0px);
  transition:background .3s,backdrop-filter .3s}
#mbg.open .mbg-bl{background:rgba(0,0,0,.48);backdrop-filter:blur(18px)}
[data-theme="light"] #mbg.open .mbg-bl{background:rgba(15,25,60,.22)}
.mbox{position:relative;z-index:1;width:100%;max-width:600px;max-height:88vh;
  overflow-y:auto;border-radius:22px;box-shadow:var(--mshadow);
  transform:scale(.88) translateY(28px);opacity:0;
  transition:transform .35s cubic-bezier(.34,1.5,.64,1),opacity .28s ease}
#mbg.open .mbox{transform:none;opacity:1}
.mhdr{position:sticky;top:0;z-index:2;padding:18px 20px 15px;
  display:flex;align-items:center;gap:13px;border-bottom:1px solid var(--gbr);
  background:var(--gb);backdrop-filter:blur(var(--blur));-webkit-backdrop-filter:blur(var(--blur))}
.mthumb{width:50px;height:50px;border-radius:11px;background:var(--gb);
  border:1px solid var(--gbr);display:flex;align-items:center;justify-content:center;
  flex-shrink:0;overflow:hidden}
.mthumb img{width:38px;height:38px;image-rendering:crisp-edges;object-fit:contain}
.mtitle{font-size:1.08rem;font-weight:700;letter-spacing:-.028em;color:var(--t1)}
.mid{font-size:.68rem;font-family:var(--mono);color:var(--t3);margin-top:1px}
.mcls{margin-left:auto;width:28px;height:28px;background:var(--gb);border:1px solid var(--gbr);
  border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-size:.78rem;color:var(--t2);flex-shrink:0;
  transition:all .2s cubic-bezier(.34,1.56,.64,1)}
.mcls:hover{border-color:var(--red);color:var(--red);background:var(--ra);transform:rotate(90deg) scale(1.1)}
.mbody{padding:18px 20px 26px}
.mstats{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;margin-bottom:18px}
.mst{border-radius:var(--rsm);padding:11px 13px;backdrop-filter:blur(10px);
  transition:transform .2s ease,background .2s ease}
.mst:hover{transform:translateY(-1px);background:var(--gb-h)}
.msl{font-size:.61rem;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--t3);margin-bottom:4px}
.msv{font-size:.96rem;font-weight:700;font-family:var(--mono);letter-spacing:-.02em;color:var(--t1)}
.msv.blue{color:var(--accent)}.msv.green{color:var(--green)}.msv.red{color:var(--red)}
.mchrt-top{display:flex;align-items:center;margin-bottom:9px}
.mchrt-title{font-size:.82rem;font-weight:600;color:var(--t2)}
.rtabs{display:flex;gap:2px;margin-left:auto;background:var(--gb);border:1px solid var(--gbr);
  border-radius:50px;padding:3px;backdrop-filter:blur(10px)}
.rtab{font-size:.65rem;font-weight:600;font-family:var(--mono);padding:4px 10px;
  border-radius:50px;color:var(--t3);cursor:pointer;transition:all .22s cubic-bezier(.34,1.4,.64,1)}
.rtab.on{background:var(--accent);color:#fff;box-shadow:0 2px 8px var(--aa);transform:scale(1.06)}
.chrtbox{border-radius:13px;padding:14px;overflow:hidden}
.chrtbox canvas{display:block;cursor:crosshair}

/* ‚îÄ‚îÄ /PAY POPUP ‚îÄ‚îÄ */
#pay-pop{position:fixed;inset:0;z-index:990;display:none;align-items:center;justify-content:center;padding:20px}
#pay-pop.open{display:flex}
.pay-card{border-radius:20px;padding:28px 32px;text-align:center;max-width:380px;width:100%;
  box-shadow:var(--mshadow);transform:scale(.88) translateY(24px);opacity:0;
  transition:transform .35s cubic-bezier(.34,1.5,.64,1),opacity .28s}
#pay-pop.open .pay-card{transform:none;opacity:1}
.pay-title{font-size:1.1rem;font-weight:700;margin-bottom:6px;color:var(--t1)}
.pay-cmd{font-family:var(--mono);font-size:1.05rem;font-weight:600;
  color:var(--green);background:var(--ga);border:1px solid rgba(52,211,153,.28);
  border-radius:8px;padding:8px 14px;margin:12px 0;display:inline-block;
  cursor:pointer;transition:all .2s;word-break:break-all}
.pay-cmd:hover{transform:scale(1.03);box-shadow:0 0 20px var(--ga)}
.pay-sub{font-size:.78rem;color:var(--t2);margin-bottom:16px}
.pay-close{background:var(--gb);border:1px solid var(--gbr);border-radius:50px;
  padding:7px 20px;font-size:.8rem;color:var(--t2);cursor:pointer;transition:all .2s}
.pay-close:hover{background:var(--gb-h);color:var(--t1)}

/* ‚îÄ‚îÄ ADMIN PANEL ‚îÄ‚îÄ */
#admin-panel{position:fixed;inset:0;z-index:970;display:none;align-items:center;justify-content:center;padding:16px}
#admin-panel.open{display:flex}
.admin-bl{position:absolute;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(16px);cursor:pointer}
.admin-box{position:relative;z-index:1;width:100%;max-width:520px;border-radius:20px;
  box-shadow:var(--mshadow);max-height:85vh;overflow-y:auto;
  transform:scale(.9) translateY(24px);opacity:0;
  transition:transform .35s cubic-bezier(.34,1.5,.64,1),opacity .28s}
#admin-panel.open .admin-box{transform:none;opacity:1}
.admin-hdr{padding:18px 20px 15px;border-bottom:1px solid var(--gbr);
  display:flex;align-items:center;gap:10px;
  position:sticky;top:0;background:var(--gb);backdrop-filter:blur(var(--blur));z-index:2}
.admin-title{font-size:1rem;font-weight:700;letter-spacing:-.02em;color:var(--t1)}
.admin-body{padding:18px 20px 24px}
.admin-sec{margin-bottom:20px}
.admin-sec-title{font-size:.72rem;font-weight:600;text-transform:uppercase;letter-spacing:.1em;
  color:var(--t3);margin-bottom:10px}
.price-entries{display:flex;flex-direction:column;gap:7px;margin-bottom:12px}
.pe-row{display:flex;align-items:center;gap:8px;padding:9px 12px;
  background:var(--gb);border:1px solid var(--gbr);border-radius:9px}
.pe-date{font-size:.72rem;font-family:var(--mono);color:var(--t3);min-width:80px}
.pe-price{font-size:.88rem;font-weight:600;font-family:var(--mono);color:var(--green);flex:1}
.pe-del{font-size:.75rem;color:var(--red);cursor:pointer;padding:2px 6px;border-radius:4px;
  transition:all .15s}
.pe-del:hover{background:var(--ra)}
.add-row{display:flex;gap:8px;align-items:center}
.ainput{flex:1;background:var(--gb);border:1px solid var(--gbr);border-radius:8px;
  padding:8px 12px;color:var(--t1);font-family:var(--font);font-size:.83rem;outline:none;
  transition:border-color .15s,box-shadow .15s}
.ainput:focus{border-color:var(--ab);box-shadow:0 0 0 3px var(--aa)}
.ainput::placeholder{color:var(--t3)}
.abtn{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;
  font-weight:600;font-size:.8rem;padding:8px 16px;border-radius:8px;border:none;
  cursor:pointer;white-space:nowrap;transition:all .2s;
  box-shadow:0 2px 12px var(--aa)}
.abtn:hover{transform:translateY(-1px);box-shadow:0 4px 18px var(--aa)}
.admin-note{font-size:.72rem;color:var(--t3);line-height:1.6;
  background:var(--gb);border:1px solid var(--gbr);border-radius:8px;
  padding:10px 12px;margin-top:10px}

/* ‚îÄ‚îÄ LOADER ‚îÄ‚îÄ */
#ldr{position:fixed;inset:0;z-index:9999;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;
  background:linear-gradient(135deg,var(--bg-a) 0%,var(--bg-b) 50%,var(--bg-c) 100%)}
.ldc{border-radius:22px;padding:28px 36px;display:flex;flex-direction:column;
  align-items:center;gap:16px;box-shadow:var(--mshadow)}
.ldg{width:54px;height:54px;border-radius:14px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;overflow:hidden;
  animation:lf 2s ease-in-out infinite;box-shadow:0 0 28px var(--aa)}
.ldg img{width:38px;height:38px;image-rendering:crisp-edges}
@keyframes lf{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-7px) scale(1.04)}}
.ldb{width:160px;height:3px;background:var(--gb);border-radius:50px;overflow:hidden}
.ldf{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:50px;
  animation:lfill 2.2s ease-in-out forwards}
@keyframes lfill{from{width:0}to{width:100%}}
.ldt{font-size:.74rem;font-family:var(--mono);color:var(--t3)}

@media(max-width:700px){
  .hero{padding:88px 16px 24px}.content{padding:12px 16px 80px}
  .grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px}
  .mstats{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>
<div class="orb o1"></div><div class="orb o2"></div><div class="orb o3"></div>

<!-- LOADER -->
<div id="ldr">
  <div class="ldc g">
    <div class="ldg"><img id="ldr-img" src="" alt=""></div>
    <div class="ldb"><div class="ldf"></div></div>
    <div class="ldt" id="ltxt">Connecting‚Ä¶</div>
  </div>
</div>

<!-- NAV -->
<div id="nav">
  <div class="np g">
    <a href="#" class="logo">
      <div class="lgem"><img id="nav-logo" src="" alt=""></div>
      <div class="ltxt">donut<b>market</b>.pro</div>
    </a>
    <div class="ns">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input id="srch" type="text" placeholder="Search items‚Ä¶" autocomplete="off">
    </div>
    <div class="nav-btns">
      <div class="nbtn admin-btn" onclick="openAdmin()">‚öôÔ∏è Admin</div>
      <div class="tgl g" id="tgl" title="Toggle dark/light"></div>
    </div>
  </div>
</div>

<!-- HERO -->
<div class="hero">
  <div class="hero-title" id="hero-title"><em>DonutSMP</em> Market</div>
</div>

<!-- CONTENT -->
<div class="content" id="content"></div>

<!-- MODAL -->
<div id="mbg" onclick="bgClick(event)">
  <div class="mbg-bl"></div>
  <div class="mbox g" id="mbox">
    <div class="mhdr">
      <div class="mthumb" id="m-thumb"></div>
      <div><div class="mtitle" id="m-title">‚Äî</div><div class="mid" id="m-id">‚Äî</div></div>
      <button class="mcls" onclick="closeModal()">‚úï</button>
    </div>
    <div class="mbody">
      <div class="mstats">
        <div class="mst g"><div class="msl">Lowest Price</div><div class="msv blue" id="m-lp">‚Äî</div></div>
        <div class="mst g"><div class="msl">24h Change</div><div class="msv" id="m-chg">‚Äî</div></div>
        <div class="mst g"><div class="msl">7d High</div><div class="msv" id="m-7h">‚Äî</div></div>
        <div class="mst g"><div class="msl">7d Low</div><div class="msv" id="m-7l">‚Äî</div></div>
      </div>
      <div class="mchrt-top">
        <div class="mchrt-title">Price History</div>
        <div class="rtabs" id="rtabs">
          <div class="rtab on" data-r="today">Today</div>
          <div class="rtab" data-r="7">7D</div>
          <div class="rtab" data-r="30">30D</div>
          <div class="rtab" data-r="90">90D</div>
        </div>
      </div>
      <div class="chrtbox g"><canvas id="mchart"></canvas></div>
    </div>
  </div>
</div>

<!-- /PAY POPUP -->
<div id="pay-pop" onclick="closePayPop(event)">
  <div class="mbg-bl"></div>
  <div class="pay-card g">
    <div class="pay-title">üíö Support donutmarket.pro</div>
    <div class="pay-sub">To keep this service running, please consider supporting us:</div>
    <div class="pay-cmd" id="pay-cmd" onclick="copyPayCmd()">/pay Schneller <span id="pay-amt">5000</span></div>
    <div class="pay-sub" style="font-size:.68rem;margin-top:-4px">Click to copy ¬∑ Thank you! üôè</div>
    <div class="pay-close" onclick="closePayPopNow()">Close</div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="admin-panel">
  <div class="admin-bl" onclick="closeAdmin()"></div>
  <div class="admin-box g">
    <div class="admin-hdr">
      <div class="admin-title">‚öôÔ∏è Admin Panel ‚Äî Manual Prices</div>
      <button class="mcls" onclick="closeAdmin()" style="margin-left:auto">‚úï</button>
    </div>
    <div class="admin-body">
      <div class="admin-sec">
        <div class="admin-sec-title">üíÄ Skeleton Spawner ‚Äî Price History</div>
        <div class="price-entries" id="pe-list"></div>
        <div class="add-row">
          <input class="ainput" id="pe-date" type="date" style="max-width:130px">
          <input class="ainput" id="pe-price" type="number" placeholder="Price (e.g. 250000)" min="0">
          <button class="abtn" onclick="addPriceEntry()">+ Add</button>
        </div>
        <div class="admin-note">
          üí° Prices saved here appear in the Skeleton Spawner graph.<br>
          <b>Global note:</b> Prices are stored in the browser. To share with others, export/import below or add entries directly in the SPAWNER_PRICES constant in the code.
        </div>
      </div>
      <div class="admin-sec">
        <div class="admin-sec-title">Export / Import</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="abtn" onclick="exportPrices()" style="background:var(--gb);border:1px solid var(--gbr);color:var(--t1);box-shadow:none">üìã Copy JSON</button>
          <button class="abtn" onclick="importPrices()" style="background:var(--gb);border:1px solid var(--gbr);color:var(--t1);box-shadow:none">üì• Paste & Import</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê CONFIG ‚ïê‚ïê */
const API='https://api.donut.auction';
const KEY='b2e3944c849c4e5ebc8a25d30d7b733c';

/* ‚ïê‚ïê HARDCODED SKELETON SPAWNER PRICES (template for manual entry)
   Format: { date: 'YYYY-MM-DD', price: number }
   Add entries here to share prices with all users
‚ïê‚ïê */
const SPAWNER_PRICES_HARDCODED = [
  // { date: '2024-01-15', price: 250000 },
  // { date: '2024-02-01', price: 280000 },
  // { date: '2024-02-15', price: 320000 },
];

/* ‚ïê‚ïê IMAGES
   Primary:  GitHub minecraft-assets (exact texture ID match)
   Secondary: mc-heads.net
   Fallback:  plain colored box
‚ïê‚ïê */
const GH='https://raw.githubusercontent.com/InventivetalentDev/minecraft-assets/1.21/assets/minecraft/textures/';
const GH_ITEM=GH+'item/';
const GH_BLOCK=GH+'block/';

// Items that live in /block/ not /item/
const BLOCK_TEX=new Set([
  'white_wool','orange_wool','magenta_wool','light_blue_wool','yellow_wool','lime_wool',
  'pink_wool','gray_wool','light_gray_wool','cyan_wool','purple_wool','blue_wool',
  'brown_wool','green_wool','red_wool','black_wool',
  'white_concrete','orange_concrete','magenta_concrete','light_blue_concrete','yellow_concrete',
  'lime_concrete','pink_concrete','gray_concrete','light_gray_concrete','cyan_concrete',
  'purple_concrete','blue_concrete','brown_concrete','green_concrete','red_concrete','black_concrete',
  'white_concrete_powder','orange_concrete_powder','magenta_concrete_powder','light_blue_concrete_powder',
  'yellow_concrete_powder','lime_concrete_powder','pink_concrete_powder','gray_concrete_powder',
  'light_gray_concrete_powder','cyan_concrete_powder','purple_concrete_powder','blue_concrete_powder',
  'brown_concrete_powder','green_concrete_powder','red_concrete_powder','black_concrete_powder',
  'white_terracotta','orange_terracotta','magenta_terracotta','light_blue_terracotta','yellow_terracotta',
  'lime_terracotta','pink_terracotta','gray_terracotta','light_gray_terracotta','cyan_terracotta',
  'purple_terracotta','blue_terracotta','brown_terracotta','green_terracotta','red_terracotta',
  'black_terracotta','terracotta',
  'white_glazed_terracotta','orange_glazed_terracotta','magenta_glazed_terracotta',
  'light_blue_glazed_terracotta','yellow_glazed_terracotta','lime_glazed_terracotta',
  'pink_glazed_terracotta','gray_glazed_terracotta','light_gray_glazed_terracotta',
  'cyan_glazed_terracotta','purple_glazed_terracotta','blue_glazed_terracotta',
  'brown_glazed_terracotta','green_glazed_terracotta','red_glazed_terracotta','black_glazed_terracotta',
  'cobblestone','stone','smooth_stone','stone_bricks','obsidian','crying_obsidian',
  'oak_planks','glass','glowstone','sea_lantern','sand','red_sand','gravel',
  'tuff','tuff_bricks','deepslate','polished_deepslate','deepslate_bricks','cobbled_deepslate',
  'blackstone','polished_blackstone','basalt','netherrack','soul_sand','soul_soil',
  'nether_bricks','quartz_block','purpur_block','end_stone','end_stone_bricks',
  'magma_block','nether_wart_block','warped_wart_block',
  'ancient_debris','netherite_block','bone_block','hay_block',
  'white_stained_glass','orange_stained_glass','magenta_stained_glass','light_blue_stained_glass',
  'yellow_stained_glass','lime_stained_glass','pink_stained_glass','gray_stained_glass',
  'light_gray_stained_glass','cyan_stained_glass','purple_stained_glass','blue_stained_glass',
  'brown_stained_glass','green_stained_glass','red_stained_glass','black_stained_glass',
  'white_carpet','orange_carpet','magenta_carpet','light_blue_carpet','yellow_carpet',
  'lime_carpet','pink_carpet','gray_carpet','light_gray_carpet','cyan_carpet',
  'purple_carpet','blue_carpet','brown_carpet','green_carpet','red_carpet','black_carpet',
  'tube_coral_block','brain_coral_block','bubble_coral_block','fire_coral_block','horn_coral_block',
  'dead_tube_coral_block','dead_brain_coral_block','dead_bubble_coral_block',
  'dead_fire_coral_block','dead_horn_coral_block',
  'bamboo_block','cherry_log','mangrove_log',
  'sculk','sculk_catalyst','sculk_sensor','calibrated_sculk_sensor','sculk_shrieker',
  'oak_log','spruce_log','birch_log','jungle_log','acacia_log','dark_oak_log',
  'stripped_oak_log','stripped_spruce_log','stripped_birch_log',
]);

function iSrc(id){
  if(id==='skeleton_spawner') return GH_BLOCK+'spawner.png';
  return BLOCK_TEX.has(id) ? GH_BLOCK+id+'.png' : GH_ITEM+id+'.png';
}
function iFb(id){
  return `https://mc-heads.net/item/${id}`;
}
function mkImg(id,sz=32){
  const s1=iSrc(id), s2=iFb(id);
  return `<img src="${s1}" width="${sz}" height="${sz}" style="image-rendering:crisp-edges;object-fit:contain" onerror="this.src='${s2}';this.onerror=function(){this.style.opacity='.25'}" alt="">`;
}

/* ‚ïê‚ïê COLORS ‚ïê‚ïê */
const COLORS=['white','orange','magenta','light_blue','yellow','lime','pink','gray','light_gray','cyan','purple','blue','brown','green','red','black'];
const COLOR_LABELS={'white':'White','orange':'Orange','magenta':'Magenta','light_blue':'Light Blue',
  'yellow':'Yellow','lime':'Lime','pink':'Pink','gray':'Gray','light_gray':'Light Gray',
  'cyan':'Cyan','purple':'Purple','blue':'Blue','brown':'Brown','green':'Green','red':'Red','black':'Black'};
const CORAL_TYPES=['tube','brain','bubble','fire','horn'];

/* ‚ïê‚ïê ITEM CATALOG ‚ïê‚ïê */
const STATIC_CATALOG = [
  // SPECIAL
  ['skeleton_spawner','Skeleton Spawner',0,'special'],

  // POPULAR
  ['elytra','Elytra',269552435,'popular'],
  ['dragon_head','Dragon Head',26323901,'popular'],
  ['piglin_head','Piglin Head',7519080,'popular'],
  ['enchanted_golden_apple','Enchanted Golden Apple',656919,'popular'],
  ['wither_skeleton_skull','Wither Skull',1200000,'popular'],
  ['nether_star','Nether Star',3500000,'popular'],
  ['beacon','Beacon',5200000,'popular'],

  // NETHERITE
  ['netherite_ingot','Netherite Ingot',5017647,'netherite'],
  ['netherite_block','Block of Netherite',41905697,'netherite'],
  ['ancient_debris','Ancient Debris',1693703,'netherite'],
  ['netherite_scrap','Netherite Scrap',890000,'netherite'],
  ['netherite_upgrade_smithing_template','Netherite Upgrade Template',850000,'netherite'],

  // MOST SOLD
  ['redstone','Redstone Dust',789,'sold'],
  ['hopper','Hopper',6483,'sold'],
  ['iron_ingot','Iron Ingot',857,'sold'],
  ['cobblestone','Cobblestone',12,'sold'],
  ['oak_log','Oak Log',89,'sold'],
  ['gunpowder','Gunpowder',420,'sold'],
  ['string','String',150,'sold'],
  ['leather','Leather',280,'sold'],
  ['iron_sword','Iron Sword',420,'sold'],
  ['iron_pickaxe','Iron Pickaxe',380,'sold'],

  // FARMING
  ['bone_block','Bone Block',46869,'farming'],
  ['sea_pickle','Sea Pickle',177,'farming'],
  ['sugar_cane','Sugar Cane',790,'farming'],
  ['bamboo','Bamboo',147,'farming'],
  ['wheat','Wheat',112,'farming'],
  ['carrot','Carrot',89,'farming'],
  ['potato','Potato',76,'farming'],
  ['nether_wart','Nether Wart',220,'farming'],
  ['kelp','Kelp',42,'farming'],
  ['cocoa_beans','Cocoa Beans',310,'farming'],
  ['pumpkin','Pumpkin',145,'farming'],
  ['melon_slice','Melon Slice',62,'farming'],
  ['honeycomb','Honeycomb',580,'farming'],
  ['honey_bottle','Honey Bottle',620,'farming'],
  ['beetroot','Beetroot',105,'farming'],
  ['sweet_berries','Sweet Berries',160,'farming'],
  ['glow_berries','Glow Berries',280,'farming'],
  ['chorus_fruit','Chorus Fruit',95,'farming'],
  ['pumpkin_seeds','Pumpkin Seeds',42,'farming'],
  ['melon_seeds','Melon Seeds',38,'farming'],
  ['wheat_seeds','Wheat Seeds',28,'farming'],
  ['nether_wart_block','Nether Wart Block',1800,'farming'],
  ['hay_block','Hay Block',7168,'farming'],

  // ORES
  ['diamond','Diamond',18500,'ores'],
  ['diamond_block','Diamond Block',1184000,'ores'],
  ['emerald','Emerald',4200,'ores'],
  ['emerald_block','Block of Emerald',268800,'ores'],
  ['gold_ingot','Gold Ingot',890,'ores'],
  ['gold_block','Block of Gold',56960,'ores'],
  ['raw_gold','Raw Gold',650,'ores'],
  ['iron_block','Block of Iron',48192,'ores'],
  ['raw_iron','Raw Iron',320,'ores'],
  ['copper_ingot','Copper Ingot',28,'ores'],
  ['raw_copper','Raw Copper',18,'ores'],
  ['coal','Coal',48,'ores'],
  ['coal_block','Block of Coal',3072,'ores'],
  ['charcoal','Charcoal',65,'ores'],
  ['lapis_lazuli','Lapis Lazuli',210,'ores'],
  ['lapis_block','Lapis Lazuli Block',13440,'ores'],
  ['redstone_block','Block of Redstone',44608,'ores'],
  ['quartz','Nether Quartz',180,'ores'],
  ['quartz_block','Block of Quartz',11520,'ores'],
  ['amethyst_shard','Amethyst Shard',340,'ores'],
  ['amethyst_block','Block of Amethyst',21760,'ores'],

  // DIAMOND ARMOR & TOOLS
  ['diamond_sword','Diamond Sword',5800,'combat'],
  ['diamond_pickaxe','Diamond Pickaxe',5200,'combat'],
  ['diamond_axe','Diamond Axe',4800,'combat'],
  ['diamond_shovel','Diamond Shovel',3200,'combat'],
  ['diamond_hoe','Diamond Hoe',2800,'combat'],
  ['diamond_chestplate','Diamond Chestplate',18500,'combat'],
  ['diamond_helmet','Diamond Helmet',12000,'combat'],
  ['diamond_leggings','Diamond Leggings',15000,'combat'],
  ['diamond_boots','Diamond Boots',9800,'combat'],
  // IRON ARMOR & TOOLS
  ['iron_chestplate','Iron Chestplate',3400,'combat'],
  ['iron_helmet','Iron Helmet',2200,'combat'],
  ['iron_leggings','Iron Leggings',2800,'combat'],
  ['iron_boots','Iron Boots',1800,'combat'],
  ['iron_axe','Iron Axe',360,'combat'],
  ['iron_shovel','Iron Shovel',280,'combat'],
  ['iron_hoe','Iron Hoe',250,'combat'],
  // GOLD ARMOR & TOOLS
  ['golden_sword','Golden Sword',180,'combat'],
  ['golden_pickaxe','Golden Pickaxe',165,'combat'],
  ['golden_axe','Golden Axe',160,'combat'],
  ['golden_shovel','Golden Shovel',140,'combat'],
  ['golden_hoe','Golden Hoe',135,'combat'],
  ['golden_helmet','Golden Helmet',1200,'combat'],
  ['golden_chestplate','Golden Chestplate',1800,'combat'],
  ['golden_leggings','Golden Leggings',1500,'combat'],
  ['golden_boots','Golden Boots',980,'combat'],
  // CHAINMAIL
  ['chainmail_helmet','Chainmail Helmet',8500,'combat'],
  ['chainmail_chestplate','Chainmail Chestplate',12000,'combat'],
  ['chainmail_leggings','Chainmail Leggings',9800,'combat'],
  ['chainmail_boots','Chainmail Boots',6200,'combat'],
  // LEATHER ARMOR
  ['leather_helmet','Leather Helmet',280,'combat'],
  ['leather_chestplate','Leather Chestplate',420,'combat'],
  ['leather_leggings','Leather Leggings',340,'combat'],
  ['leather_boots','Leather Boots',220,'combat'],
  ['leather_horse_armor','Leather Horse Armor',680,'combat'],
  ['iron_horse_armor','Iron Horse Armor',2200,'combat'],
  ['golden_horse_armor','Golden Horse Armor',1800,'combat'],
  ['diamond_horse_armor','Diamond Horse Armor',12000,'combat'],
  // WEAPONS
  ['bow','Bow',620,'combat'],
  ['crossbow','Crossbow',1200,'combat'],
  ['arrow','Arrow',38,'combat'],
  ['spectral_arrow','Spectral Arrow',55,'combat'],
  ['trident','Trident',45000,'combat'],
  ['mace','Mace',180000,'combat'],
  ['shield','Shield',890,'combat'],
  ['ender_pearl','Ender Pearl',680,'combat'],
  ['eye_of_ender','Eye of Ender',1800,'combat'],
  ['blaze_rod','Blaze Rod',750,'combat'],
  ['blaze_powder','Blaze Powder',380,'combat'],
  ['ghast_tear','Ghast Tear',1800,'combat'],
  ['magma_cream','Magma Cream',420,'combat'],
  ['slime_ball','Slimeball',320,'combat'],
  ['fire_charge','Fire Charge',450,'combat'],

  // BUILDING
  ['stone','Stone',15,'building'],
  ['smooth_stone','Smooth Stone',22,'building'],
  ['stone_bricks','Stone Bricks',38,'building'],
  ['chiseled_stone_bricks','Chiseled Stone Bricks',85,'building'],
  ['cracked_stone_bricks','Cracked Stone Bricks',72,'building'],
  ['mossy_stone_bricks','Mossy Stone Bricks',95,'building'],
  ['obsidian','Obsidian',120,'building'],
  ['crying_obsidian','Crying Obsidian',450,'building'],
  ['oak_planks','Oak Planks',28,'building'],
  ['spruce_planks','Spruce Planks',26,'building'],
  ['birch_planks','Birch Planks',30,'building'],
  ['jungle_planks','Jungle Planks',42,'building'],
  ['acacia_planks','Acacia Planks',35,'building'],
  ['dark_oak_planks','Dark Oak Planks',36,'building'],
  ['mangrove_planks','Mangrove Planks',48,'building'],
  ['cherry_planks','Cherry Planks',95,'building'],
  ['bamboo_planks','Bamboo Planks',32,'building'],
  ['crimson_planks','Crimson Planks',55,'building'],
  ['warped_planks','Warped Planks',55,'building'],
  ['oak_log','Oak Log',89,'building'],
  ['spruce_log','Spruce Log',85,'building'],
  ['birch_log','Birch Log',92,'building'],
  ['jungle_log','Jungle Log',120,'building'],
  ['acacia_log','Acacia Log',105,'building'],
  ['dark_oak_log','Dark Oak Log',110,'building'],
  ['mangrove_log','Mangrove Log',135,'building'],
  ['cherry_log','Cherry Log',280,'building'],
  ['bamboo_block','Bamboo Block',9216,'building'],
  ['glass','Glass',32,'building'],
  ['glowstone','Glowstone',380,'building'],
  ['sea_lantern','Sea Lantern',290,'building'],
  ['shroomlight','Shroomlight',420,'building'],
  ['lantern','Lantern',180,'building'],
  ['soul_lantern','Soul Lantern',280,'building'],
  ['sand','Sand',45,'building'],
  ['red_sand','Red Sand',55,'building'],
  ['gravel','Gravel',38,'building'],
  ['flint','Flint',85,'building'],
  ['tuff','Tuff',48,'building'],
  ['tuff_bricks','Tuff Bricks',95,'building'],
  ['deepslate','Deepslate',68,'building'],
  ['polished_deepslate','Polished Deepslate',95,'building'],
  ['deepslate_bricks','Deepslate Bricks',120,'building'],
  ['cobbled_deepslate','Cobbled Deepslate',55,'building'],
  ['blackstone','Blackstone',75,'building'],
  ['polished_blackstone','Polished Blackstone',95,'building'],
  ['basalt','Basalt',65,'building'],
  ['netherrack','Netherrack',18,'building'],
  ['soul_sand','Soul Sand',95,'building'],
  ['soul_soil','Soul Soil',88,'building'],
  ['nether_bricks','Nether Bricks',120,'building'],
  ['red_nether_bricks','Red Nether Bricks',145,'building'],
  ['quartz_bricks','Quartz Bricks',280,'building'],
  ['purpur_block','Purpur Block',85,'building'],
  ['end_stone','End Stone',95,'building'],
  ['end_stone_bricks','End Stone Bricks',145,'building'],
  ['magma_block','Magma Block',85,'building'],
  ['gilded_blackstone','Gilded Blackstone',380,'building'],
  ['prismarine','Prismarine',280,'building'],
  ['prismarine_bricks','Prismarine Bricks',340,'building'],
  ['dark_prismarine','Dark Prismarine',380,'building'],

  // REDSTONE
  ['piston','Piston',580,'redstone'],
  ['sticky_piston','Sticky Piston',980,'redstone'],
  ['observer','Observer',480,'redstone'],
  ['comparator','Redstone Comparator',380,'redstone'],
  ['repeater','Redstone Repeater',280,'redstone'],
  ['dispenser','Dispenser',580,'redstone'],
  ['dropper','Dropper',320,'redstone'],
  ['daylight_detector','Daylight Detector',420,'redstone'],
  ['target','Target',680,'redstone'],
  ['note_block','Note Block',580,'redstone'],
  ['jukebox','Jukebox',1800,'redstone'],
  ['crafting_table','Crafting Table',95,'redstone'],
  ['furnace','Furnace',180,'redstone'],
  ['blast_furnace','Blast Furnace',2800,'redstone'],
  ['smoker','Smoker',1200,'redstone'],
  ['campfire','Campfire',480,'redstone'],
  ['soul_campfire','Soul Campfire',680,'redstone'],
  ['brewing_stand','Brewing Stand',2400,'redstone'],
  ['enchanting_table','Enchanting Table',18500,'redstone'],
  ['grindstone','Grindstone',1200,'redstone'],
  ['smithing_table','Smithing Table',980,'redstone'],
  ['stonecutter','Stonecutter',850,'redstone'],
  ['ender_chest','Ender Chest',12000,'redstone'],
  ['shulker_box','Shulker Box',5200,'redstone'],
  ['chest','Chest',280,'redstone'],
  ['trapped_chest','Trapped Chest',480,'redstone'],
  ['barrel','Barrel',580,'redstone'],
  ['anvil','Anvil',4800,'redstone'],
  ['crafter','Crafter',22000,'redstone'],
  ['hopper','Hopper',6483,'redstone'],

  // RARE & 1.21
  ['heart_of_the_sea','Heart of the Sea',120000,'rare'],
  ['echo_shard','Echo Shard',15000,'rare'],
  ['heavy_core','Heavy Core',950000,'rare'],
  ['breeze_rod','Breeze Rod',28000,'rare'],
  ['wind_charge','Wind Charge',1200,'rare'],
  ['trial_key','Trial Key',4500,'rare'],
  ['ominous_trial_key','Ominous Trial Key',18000,'rare'],
  ['ominous_bottle','Ominous Bottle',3200,'rare'],
  ['armadillo_scute','Armadillo Scute',2800,'rare'],
  ['music_disc_pigstep','Music Disc (Pigstep)',85000,'rare'],
  ['music_disc_otherside','Music Disc (Otherside)',72000,'rare'],
  ['music_disc_relic','Music Disc (Relic)',95000,'rare'],
  ['music_disc_creator','Music Disc (Creator)',62000,'rare'],
  ['music_disc_precipice','Music Disc (Precipice)',58000,'rare'],
  ['music_disc_13','Music Disc (13)',4200,'rare'],
  ['music_disc_cat','Music Disc (Cat)',3800,'rare'],
  ['dragon_egg','Dragon Egg',0,'rare'],
  ['end_crystal','End Crystal',35000,'rare'],
  ['nautilus_shell','Nautilus Shell',8500,'rare'],
  ['wither_rose','Wither Rose',8500,'rare'],

  // ENCHANTED BOOKS
  ['mending_book','Mending',38000,'books'],
  ['sharpness_v_book','Sharpness V',28000,'books'],
  ['protection_iv_book','Protection IV',22000,'books'],
  ['efficiency_v_book','Efficiency V',18000,'books'],
  ['fortune_iii_book','Fortune III',45000,'books'],
  ['silk_touch_book','Silk Touch',32000,'books'],
  ['looting_iii_book','Looting III',15000,'books'],
  ['unbreaking_iii_book','Unbreaking III',8000,'books'],
  ['infinity_book','Infinity',55000,'books'],
  ['flame_book','Flame',7200,'books'],
  ['power_v_book','Power V',25000,'books'],
  ['swift_sneak_iii_book','Swift Sneak III',380000,'books'],
  ['soul_speed_iii_book','Soul Speed III',125000,'books'],
  ['feather_falling_iv_book','Feather Falling IV',28000,'books'],
  ['frost_walker_ii_book','Frost Walker II',18000,'books'],
  ['depth_strider_iii_book','Depth Strider III',14000,'books'],
  ['aqua_affinity_book','Aqua Affinity',9500,'books'],
  ['channeling_book','Channeling',8800,'books'],
  ['riptide_iii_book','Riptide III',22000,'books'],
  ['loyalty_iii_book','Loyalty III',12000,'books'],
  ['impaling_v_book','Impaling V',9500,'books'],
  ['density_v_book','Density V',38000,'books'],
  ['breach_iv_book','Breach IV',32000,'books'],
  ['wind_burst_iii_book','Wind Burst III',28000,'books'],
  ['knockback_ii_book','Knockback II',3200,'books'],
  ['smite_v_book','Smite V',5400,'books'],
  ['sweeping_edge_iii_book','Sweeping Edge III',8500,'books'],
  ['thorns_iii_book','Thorns III',6800,'books'],
  ['respiration_iii_book','Respiration III',12000,'books'],
  ['punch_ii_book','Punch II',4800,'books'],
  ['multishot_book','Multishot',15000,'books'],
  ['piercing_iv_book','Piercing IV',8200,'books'],
  ['quick_charge_iii_book','Quick Charge III',6500,'books'],

  // FOOD & MISC
  ['apple','Apple',65,'misc'],
  ['golden_apple','Golden Apple',4800,'misc'],
  ['bread','Bread',120,'misc'],
  ['cooked_beef','Steak',280,'misc'],
  ['cooked_porkchop','Cooked Porkchop',260,'misc'],
  ['cooked_chicken','Cooked Chicken',220,'misc'],
  ['cooked_cod','Cooked Cod',185,'misc'],
  ['cooked_salmon','Cooked Salmon',240,'misc'],
  ['cooked_mutton','Cooked Mutton',210,'misc'],
  ['cooked_rabbit','Cooked Rabbit',320,'misc'],
  ['golden_carrot','Golden Carrot',2200,'misc'],
  ['pumpkin_pie','Pumpkin Pie',380,'misc'],
  ['cake','Cake',480,'misc'],
  ['cookie','Cookie',95,'misc'],
  ['bone','Bone',95,'misc'],
  ['bone_meal','Bone Meal',68,'misc'],
  ['rotten_flesh','Rotten Flesh',22,'misc'],
  ['glass_bottle','Glass Bottle',28,'misc'],
  ['paper','Paper',22,'misc'],
  ['book','Book',65,'misc'],
  ['name_tag','Name Tag',2800,'misc'],
  ['saddle','Saddle',4800,'misc'],
  ['lead','Lead',680,'misc'],
  ['tnt','TNT',380,'misc'],
  ['sponge','Sponge',8500,'misc'],
  ['wet_sponge','Wet Sponge',2800,'misc'],
  ['shulker_shell','Shulker Shell',4800,'misc'],
  ['phantom_membrane','Phantom Membrane',2200,'misc'],
  ['prismarine_shard','Prismarine Shard',320,'misc'],
  ['prismarine_crystals','Prismarine Crystals',380,'misc'],
  ['ink_sac','Ink Sac',180,'misc'],
  ['glow_ink_sac','Glow Ink Sac',480,'misc'],
  ['feather','Feather',95,'misc'],
  ['spider_eye','Spider Eye',95,'misc'],
  ['fermented_spider_eye','Fermented Spider Eye',420,'misc'],
  ['scute','Scute',1800,'misc'],
  ['turtle_helmet','Turtle Helmet',8500,'misc'],
  ['rabbit_foot','Rabbit Foot',1200,'misc'],
  ['rabbit_hide','Rabbit Hide',95,'misc'],
  ['ender_eye','Eye of Ender',1800,'misc'],
  ['flint','Flint',85,'misc'],
  ['flint_and_steel','Flint and Steel',180,'misc'],
  ['bucket','Bucket',220,'misc'],
  ['shears','Shears',340,'misc'],
  ['clock','Clock',1800,'misc'],
  ['compass','Compass',580,'misc'],
  ['spyglass','Spyglass',3800,'misc'],
  ['goat_horn','Goat Horn',8200,'misc'],
  ['book_and_quill','Book and Quill',180,'misc'],
  ['minecart','Minecart',380,'misc'],
  ['oak_boat','Oak Boat',220,'misc'],
];

// Generate color variants
function genColored(){
  const items=[];
  COLORS.forEach(c=>{
    const lbl=COLOR_LABELS[c];
    items.push([`${c}_wool`,`${lbl} Wool`,120,'wool']);
    items.push([`${c}_concrete`,`${lbl} Concrete`,35,'concrete']);
    items.push([`${c}_concrete_powder`,`${lbl} Concrete Powder`,28,'concrete']);
    items.push([`${c}_stained_glass`,`${lbl} Stained Glass`,65,'glass_pane']);
    items.push([`${c}_stained_glass_pane`,`${lbl} Glass Pane`,38,'glass_pane']);
    items.push([`${c}_carpet`,`${lbl} Carpet`,65,'wool']);
    items.push([`${c}_terracotta`,`${lbl} Terracotta`,55,'terracotta']);
    items.push([`${c}_glazed_terracotta`,`${lbl} Glazed Terracotta`,95,'terracotta']);
    items.push([`${c}_shulker_box`,`${lbl} Shulker Box`,5400,'redstone']);
    items.push([`${c}_dye`,`${lbl} Dye`,180,'dye']);
    items.push([`${c}_bed`,`${lbl} Bed`,580,'misc']);
    items.push([`${c}_candle`,`${lbl} Candle`,95,'misc']);
    items.push([`${c}_banner`,`${lbl} Banner`,280,'misc']);
  });
  CORAL_TYPES.forEach(t=>{
    items.push([`${t}_coral`,`${t.charAt(0).toUpperCase()+t.slice(1)} Coral`,220,'coral']);
    items.push([`${t}_coral_block`,`${t.charAt(0).toUpperCase()+t.slice(1)} Coral Block`,280,'coral']);
    items.push([`${t}_coral_fan`,`${t.charAt(0).toUpperCase()+t.slice(1)} Coral Fan`,180,'coral']);
    items.push([`dead_${t}_coral`,`Dead ${t.charAt(0).toUpperCase()+t.slice(1)} Coral`,45,'coral']);
    items.push([`dead_${t}_coral_block`,`Dead ${t.charAt(0).toUpperCase()+t.slice(1)} Coral Block`,65,'coral']);
  });
  return items;
}
const COLORED=genColored();

// Merge, dedup
const _s=new Set();
const ITEMS=[...STATIC_CATALOG,...COLORED].filter(([id])=>{if(_s.has(id))return false;_s.add(id);return true;});

const SECTIONS=[
  {key:'special',label:'üéÆ Special Items'},
  {key:'popular',label:'Popular Investments'},
  {key:'netherite',label:'Netherite'},
  {key:'sold',label:'Most Sold'},
  {key:'farming',label:'Farming Items'},
  {key:'ores',label:'Ores & Minerals'},
  {key:'combat',label:'Combat & Armor'},
  {key:'building',label:'Building Blocks'},
  {key:'redstone',label:'Redstone & Tech'},
  {key:'wool',label:'Wool & Carpet'},
  {key:'concrete',label:'Concrete'},
  {key:'glass_pane',label:'Stained Glass'},
  {key:'terracotta',label:'Terracotta'},
  {key:'dye',label:'Dyes'},
  {key:'coral',label:'Coral'},
  {key:'rare',label:'Rare & 1.21'},
  {key:'books',label:'Enchanted Books'},
  {key:'misc',label:'Food & Misc'},
];

/* ‚ïê‚ïê FORMATTERS ‚ïê‚ïê */
function fmtP(n){
  if(!n||isNaN(n)||n===0)return'‚Äî';n=+n;
  if(n>=1e9)return'$'+(n/1e9).toFixed(3).replace(/\.?0+$/,'')+'B';
  if(n>=1e6)return'$'+(n/1e6).toFixed(2).replace(/\.?0+$/,'')+'M';
  if(n>=1000)return'$'+Math.round(n).toLocaleString('en-US');
  if(n>=1)return'$'+n.toLocaleString('en-US',{maximumFractionDigits:2});
  return'$'+n.toFixed(4);
}
function fmtK(n){n=+n;if(n>=1e9)return(n/1e9).toFixed(2)+'B';if(n>=1e6)return(n/1e6).toFixed(1)+'M';if(n>=1000)return(n/1e3).toFixed(0)+'K';return Math.round(n).toLocaleString('en-US')}

/* ‚ïê‚ïê SEEDED RNG ‚ïê‚ïê */
function srng(s){let h=2166136261;for(let i=0;i<s.length;i++)h=(h^s.charCodeAt(i))*16777619|0;h=h>>>0;return()=>{h^=h<<13;h^=h>>>17;h^=h<<5;h=h>>>0;return h/4294967296}}

/* ‚ïê‚ïê PRICE HISTORY ‚ïê‚ïê */
function genHist(base,n,step,seed){
  if(!base||base<=0)return [];
  const rng=srng(seed);
  let p=base*(0.92+rng()*.16);
  const now=Date.now();
  return Array.from({length:n+1},(_,i)=>{
    p=Math.max(p+(rng()-.48)*.022*p,0.01);
    return{t:new Date(now-(n-i)*step),y:Math.round(p*100)/100};
  });
}
const H={
  today:(b,id)=>genHist(b,24,3600000,id+'T'),
  '7':  (b,id)=>genHist(b,28,6*3600000,id+'7'),
  '30': (b,id)=>genHist(b,30,86400000,id+'30'),
  '90': (b,id)=>genHist(b,90,86400000,id+'90'),
};

// Spawner manual history (merge hardcoded + localStorage)
function getSpawnerHistory(){
  let entries=[...SPAWNER_PRICES_HARDCODED];
  try{const ls=JSON.parse(localStorage.getItem('spawner_prices')||'[]');entries=[...entries,...ls];}catch(e){}
  entries.sort((a,b)=>new Date(a.date)-new Date(b.date));
  return entries;
}
function saveSpawnerHistory(arr){try{localStorage.setItem('spawner_prices',JSON.stringify(arr));}catch(e){}}
function getLocalSpawnerEntries(){try{return JSON.parse(localStorage.getItem('spawner_prices')||'[]');}catch(e){return[];}}

/* ‚ïê‚ïê STATE ‚ïê‚ïê */
let orderMin={}, auctionMin={}, lowestMap={}, srcMap={};
let sparkMap={}, mChart=null, mId=null, searchQ='', isDark=true;
let modalIsOpen=false;

/* ‚ïê‚ïê THEME ‚ïê‚ïê */
function setTheme(dark){
  isDark=dark;
  document.documentElement.setAttribute('data-theme',dark?'dark':'light');
}
document.getElementById('tgl').addEventListener('click',()=>{
  setTheme(!isDark);
  if(mChart&&mId){
    const r=document.querySelector('.rtab.on')?.dataset.r||'today';
    requestAnimationFrame(()=>drawModalChart(mId,r));
  }
});

/* ‚ïê‚ïê API ‚ïê‚ïê */
async function fetchOrders(cursor=null){
  try{
    const url=new URL(`${API}/orders`);
    if(cursor)url.searchParams.set('cursor',cursor);
    const r=await fetch(url,{headers:{'x-api-key':KEY}});
    if(!r.ok)return;
    const d=await r.json();
    (d.orders||[]).forEach(o=>{
      const id=o.item?.itemId||o.itemId;
      const p=+o.itemPrice;
      if(id&&p>0&&(!orderMin[id]||p<orderMin[id]))orderMin[id]=p;
    });
    if(d.nextCursor)await fetchOrders(d.nextCursor);
  }catch(e){console.warn(e.message)}
}
async function fetchAuctions(){
  for(const path of['/auctions','/v1/auctions','/v1/items','/auction']){
    try{
      const r=await fetch(API+path,{headers:{'x-api-key':KEY}});
      if(!r.ok)continue;
      const d=await r.json();
      const arr=d.auctions||d.items||d.data||d||[];
      if(Array.isArray(arr)&&arr.length>0){
        arr.forEach(a=>{
          const id=a.itemId||a.item?.itemId;
          const p=+(a.price||a.itemPrice||a.pricePerItem||0);
          if(id&&p>0&&(!auctionMin[id]||p<auctionMin[id]))auctionMin[id]=p;
        });
        break;
      }
    }catch(e){}
  }
}
function buildMaps(){
  ITEMS.forEach(([id,,fb])=>{
    const a=auctionMin[id],o=orderMin[id];
    if(a&&o){lowestMap[id]=Math.min(a,o);srcMap[id]='both';}
    else if(a){lowestMap[id]=a;srcMap[id]='auction';}
    else if(o){lowestMap[id]=o;srcMap[id]='order';}
    else{lowestMap[id]=fb||0;srcMap[id]='est';}
  });
  // Skeleton spawner: use highest known manual price
  const sh=getSpawnerHistory();
  if(sh.length){
    const latest=sh[sh.length-1].price;
    if(latest>0){lowestMap['skeleton_spawner']=latest;srcMap['skeleton_spawner']='manual';}
  }
}

/* ‚ïê‚ïê SPARKLINE ‚ïê‚ïê */
function drawSpark(cid,id,base){
  if(sparkMap[cid]){try{sparkMap[cid].destroy()}catch(e){}}
  const el=document.getElementById(cid);if(!el)return;
  let pts;
  if(id==='skeleton_spawner'){
    const sh=getSpawnerHistory();
    if(sh.length>=2){pts=sh.map(e=>({t:new Date(e.date),y:e.price}));}
    else{pts=genHist(base||100000,24,3600000,id+'T');}
  } else {
    pts=genHist(base||1,24,3600000,id+'T');
  }
  if(!pts.length)return;
  const up=pts[pts.length-1].y>=pts[0].y;
  const col=up?'#34d399':'#f87171';
  sparkMap[cid]=new Chart(el,{
    type:'line',
    data:{labels:pts.map(p=>p.t),datasets:[{
      data:pts.map(p=>p.y),borderColor:col,borderWidth:1.5,fill:true,
      backgroundColor:ctx=>{const g=ctx.chart.ctx.createLinearGradient(0,0,0,30);g.addColorStop(0,col+'28');g.addColorStop(1,col+'00');return g},
      pointRadius:0,tension:0.4
    }]},
    options:{responsive:false,animation:false,plugins:{legend:{display:false},tooltip:{enabled:false}},scales:{x:{display:false},y:{display:false}}}
  });
}

/* ‚ïê‚ïê MODAL CHART ‚ïê‚ïê */
function destroyChart(){
  if(mChart){try{mChart.destroy();}catch(e){}mChart=null;}
  const el=document.getElementById('mchart');
  if(el){try{const ctx=el.getContext('2d');if(ctx)ctx.clearRect(0,0,el.width,el.height);}catch(e){}}
}

function drawModalChart(id,range){
  destroyChart();
  const el=document.getElementById('mchart');if(!el)return;
  const base=lowestMap[id]||ITEMS.find(i=>i[0]===id)?.[2]||100;

  let aDat=[], oDat=[];

  if(id==='skeleton_spawner'){
    const sh=getSpawnerHistory();
    if(sh.length>=2){
      aDat=sh.map(e=>({t:new Date(e.date),y:e.price}));
      oDat=sh.map(e=>({t:new Date(e.date),y:Math.round(e.price*.95)}));
    } else {
      aDat=genHist(base||100000,range==='today'?24:+range<=7?28:+range<=30?30:90,
        range==='today'?3600000:+range<=7?6*3600000:86400000,id+'a');
      oDat=genHist((base||100000)*.95,aDat.length-1,
        range==='today'?3600000:+range<=7?6*3600000:86400000,id+'o');
      oDat=aDat.map((d,i)=>({t:d.t,y:Math.round(d.y*.95)}));
    }
  } else {
    const aBase=auctionMin[id]||base;
    const oBase=orderMin[id]||base*.95;
    const fn=H[range]||H.today;
    aDat=fn(aBase,id+'a');
    oDat=fn(oBase,id+'o');
  }

  if(!aDat.length&&!oDat.length){return;}

  let fmtL;
  if(range==='today')fmtL=d=>d.toLocaleTimeString('en',{hour:'2-digit',minute:'2-digit'});
  else if(+range<=7)fmtL=d=>d.toLocaleDateString('en',{weekday:'short',month:'short',day:'numeric'});
  else if(+range<=30)fmtL=d=>d.toLocaleDateString('en',{month:'short',day:'numeric'});
  else fmtL=d=>d.toLocaleDateString('en',{month:'short',year:'2-digit'});

  const box=el.parentElement;
  const W=Math.max(box.clientWidth-28,200);
  const H_px=180;
  const dpr=window.devicePixelRatio||1;
  el.width=W*dpr;el.height=H_px*dpr;
  el.style.width=W+'px';el.style.height=H_px+'px';

  const dark=isDark;
  const gridCol=dark?'rgba(255,255,255,.05)':'rgba(0,0,0,.05)';
  const tickCol=dark?'rgba(255,255,255,.32)':'rgba(0,0,0,.38)';
  const tipBg=dark?'rgba(10,14,28,.97)':'rgba(255,255,255,.97)';
  const tipBdr=dark?'rgba(255,255,255,.1)':'rgba(180,200,230,.8)';
  const tipTxt=dark?'rgba(255,255,255,.9)':'rgba(10,15,35,.9)';
  const accent=dark?'#3b82f6':'#2563eb';
  const gold=dark?'#fbbf24':'#d97706';

  mChart=new Chart(el,{
    type:'line',
    data:{
      labels:aDat.map(d=>fmtL(d.t)),
      datasets:[
        {label:'Auction',data:aDat.map(d=>d.y),borderColor:gold,borderWidth:2.2,
          fill:false,tension:.4,pointRadius:0,pointHoverRadius:5,
          pointHoverBackgroundColor:gold,pointHoverBorderColor:tipBg,pointHoverBorderWidth:2},
        {label:'Order',data:oDat.map(d=>d.y),borderColor:accent,borderWidth:2.2,
          fill:false,tension:.4,pointRadius:0,pointHoverRadius:5,
          pointHoverBackgroundColor:accent,pointHoverBorderColor:tipBg,pointHoverBorderWidth:2}
      ]
    },
    options:{
      responsive:false,devicePixelRatio:dpr,
      interaction:{mode:'index',intersect:false},
      animation:{duration:450,easing:'easeOutQuart'},
      plugins:{
        legend:{display:true,position:'top',align:'end',
          labels:{color:tickCol,font:{family:'-apple-system,BlinkMacSystemFont,system-ui,sans-serif',size:11,weight:'500'},
            boxWidth:8,boxHeight:8,padding:14,usePointStyle:true,pointStyle:'circle'}},
        tooltip:{enabled:true,backgroundColor:tipBg,borderColor:tipBdr,borderWidth:1,
          padding:{top:9,right:13,bottom:9,left:13},cornerRadius:10,
          titleColor:dark?'rgba(255,255,255,.4)':'rgba(0,0,0,.4)',
          titleFont:{size:10,weight:'500'},
          bodyColor:tipTxt,bodyFont:{size:12,weight:'600'},
          boxPadding:4,caretPadding:6,
          callbacks:{label:c=>` ${c.dataset.label}: ${fmtP(c.raw)}`}}
      },
      scales:{
        x:{grid:{color:gridCol,drawBorder:false},
          ticks:{color:tickCol,font:{size:10},maxRotation:0,maxTicksLimit:8,padding:5},
          border:{display:false}},
        y:{grid:{color:gridCol,drawBorder:false},
          ticks:{color:tickCol,font:{size:10},callback:v=>fmtK(v),padding:7},
          border:{display:false}}
      }
    },
    plugins:[{id:'xhair',afterDraw(c){
      if(c.tooltip._active?.length){
        const cx=c.ctx,x=c.tooltip._active[0].element.x;
        const{top,bottom}=c.chartArea;
        cx.save();cx.beginPath();cx.moveTo(x,top);cx.lineTo(x,bottom);
        cx.strokeStyle=dark?'rgba(255,255,255,.12)':'rgba(0,0,80,.08)';
        cx.lineWidth=1;cx.setLineDash([3,3]);cx.stroke();cx.restore();
      }
    }}]
  });
  el.style.cursor='crosshair';
}

/* ‚ïê‚ïê RENDER ‚ïê‚ïê */
function render(){
  const ct=document.getElementById('content');
  const q=searchQ.trim().toLowerCase();
  ct.innerHTML='';
  if(q){
    const found=ITEMS.filter(([id,name])=>name.toLowerCase().includes(q)||id.includes(q));
    if(found.length)renderSection(ct,'Search Results','search',found);
    else ct.innerHTML=`<div style="text-align:center;color:var(--t3);padding:60px 0;font-size:.9rem">No results for "${q}"</div>`;
    return;
  }
  SECTIONS.forEach(({key,label})=>{
    const items=ITEMS.filter(i=>i[3]===key);
    if(items.length)renderSection(ct,label,key,items);
  });
}

function renderSection(parent,label,key,items){
  const wrap=document.createElement('div');
  wrap.innerHTML=`<div class="sec-hdr"><div class="sec-name">${label}</div><div class="sec-ct">${items.length}</div></div><div class="grid" id="g-${key}"></div>`;
  parent.appendChild(wrap);
  const grid=wrap.querySelector('.grid');

  items.forEach(([id,name,,sec],idx)=>{
    const p=lowestMap[id]||0;
    const src=srcMap[id]||'est';
    const rng=srng(id+'chg');
    const chg=(rng()-.47)*.09;
    const cc=chg>.005?'up':chg<-.005?'dn':'fl';
    const cs=(chg>=0?'+':'')+(chg*100).toFixed(1)+'%';
    const sid=`sp-${key}-${idx}`;

    const card=document.createElement('div');
    card.className='card g';
    card.innerHTML=`
      <div class="ctop">
        <div class="cimg">${mkImg(id,32)}</div>
        <div style="min-width:0">
          <div class="cname">${name}</div>
          <div class="cid">${id}</div>
        </div>
      </div>
      <div class="cprice">${p>0?fmtP(p):'‚Äî'}</div>
      <div class="sp-wrap"><canvas id="${sid}"></canvas></div>
      <div class="cbot">
        <div class="cchg ${cc}">${cc==='up'?'‚ñ≤':cc==='dn'?'‚ñº':'‚Äî'} ${cs}</div>
        <div class="csrc">
          ${src==='auction'||src==='both'?'<span class="spill a">A</span>':''}
          ${src==='order'||src==='both'?'<span class="spill o">O</span>':''}
          ${src==='manual'?'<span class="spill o">M</span>':''}
          ${src==='est'?'<span class="spill e">est</span>':''}
        </div>
      </div>`;
    grid.appendChild(card);
    card.addEventListener('click',()=>handleCardClick(id));
    setTimeout(()=>drawSpark(sid,id,p||1),idx*4+40);
  });

  const hdr=wrap.querySelector('.sec-hdr');
  gsap.to(hdr,{opacity:1,y:0,duration:.5,ease:'power2.out',
    scrollTrigger:{trigger:hdr,start:'top 90%',once:true}});
  gsap.fromTo(grid.children,
    {opacity:0,y:18,scale:.97},
    {opacity:1,y:0,scale:1,duration:.42,stagger:.014,ease:'back.out(1.2)',
      scrollTrigger:{trigger:grid,start:'top 92%',once:true}});
}

/* ‚ïê‚ïê CARD CLICK ‚ïê‚ïê */
function handleCardClick(id){
  if(id==='skeleton_spawner'){
    openModal(id);
    // Show pay popup after 1.5s
    setTimeout(()=>{
      if(modalIsOpen&&mId==='skeleton_spawner')showPayPop(lowestMap[id]||250000);
    },1500);
  } else {
    openModal(id);
  }
}

/* ‚ïê‚ïê MODAL ‚ïê‚ïê */
function openModal(id){
  // Fully clean up previous modal
  destroyChart();
  mId=id;

  const item=ITEMS.find(i=>i[0]===id);if(!item)return;
  const[,name,fb]=item;
  const p=lowestMap[id]||0;

  document.getElementById('m-thumb').innerHTML=mkImg(id,38);
  document.getElementById('m-title').textContent=name;
  document.getElementById('m-id').textContent=id;
  document.getElementById('m-lp').textContent=p>0?fmtP(p):'‚Äî';

  const rng=srng(id+'m');
  const chg=(rng()-.46)*.12;
  const cel=document.getElementById('m-chg');
  cel.textContent=(chg>=0?'+':'')+(chg*100).toFixed(2)+'%';
  cel.className='msv '+(chg>.005?'green':chg<-.005?'red':'');

  const h7=H['7'](p||1,id);
  const vals=h7.map(d=>d.y);
  document.getElementById('m-7h').textContent=vals.length?fmtP(Math.max(...vals)):'‚Äî';
  document.getElementById('m-7l').textContent=vals.length?fmtP(Math.min(...vals)):'‚Äî';

  // Reset range tabs
  document.querySelectorAll('#rtabs .rtab').forEach(t=>{
    const newT=t.cloneNode(true);
    t.parentNode.replaceChild(newT,t);
  });
  document.querySelectorAll('#rtabs .rtab').forEach(t=>{
    t.classList.toggle('on',t.dataset.r==='today');
    t.addEventListener('click',()=>{
      document.querySelectorAll('#rtabs .rtab').forEach(x=>x.classList.remove('on'));
      t.classList.add('on');
      gsap.fromTo(t,{scale:.88},{scale:1,duration:.25,ease:'back.out(1.8)'});
      requestAnimationFrame(()=>drawModalChart(id,t.dataset.r));
    });
  });

  const bg=document.getElementById('mbg');
  bg.style.display='flex';
  document.body.style.overflow='hidden';
  modalIsOpen=true;

  requestAnimationFrame(()=>{
    drawModalChart(id,'today');
  });

  const bl=bg.querySelector('.mbg-bl');
  gsap.fromTo(bl,{background:'rgba(0,0,0,0)',backdropFilter:'blur(0px)'},
    {background:isDark?'rgba(0,0,0,.48)':'rgba(15,25,60,.22)',backdropFilter:'blur(18px)',duration:.3,ease:'power2.out'});
  gsap.fromTo('#mbox',{scale:.88,y:28,opacity:0},{scale:1,y:0,opacity:1,duration:.36,ease:'back.out(1.4)'});
  bg.classList.add('open');

  gsap.fromTo('.mst',{opacity:0,y:10,scale:.95},{opacity:1,y:0,scale:1,duration:.38,stagger:.06,ease:'back.out(1.3)',delay:.1});
}

function closeModal(){
  if(!modalIsOpen)return;
  modalIsOpen=false;
  const bg=document.getElementById('mbg');
  const bl=bg.querySelector('.mbg-bl');
  gsap.to('#mbox',{scale:.9,y:22,opacity:0,duration:.24,ease:'power2.in',onComplete:()=>{
    bg.style.display='none';bg.classList.remove('open');
    document.body.style.overflow='';
    destroyChart();
    mId=null;
  }});
  gsap.to(bl,{background:'rgba(0,0,0,0)',backdropFilter:'blur(0px)',duration:.26,ease:'power2.in'});
}
function bgClick(e){
  if(e.target===document.getElementById('mbg')||e.target.classList.contains('mbg-bl'))closeModal();
}
document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeModal();closePayPopNow();closeAdmin();}});

/* ‚ïê‚ïê PAY POPUP ‚ïê‚ïê */
function showPayPop(price){
  const amt=Math.ceil(price*0.001/100)*100||5000;
  document.getElementById('pay-amt').textContent=amt.toLocaleString('en-US');
  document.getElementById('pay-cmd').dataset.cmd=`/pay Schneller ${amt}`;
  const pp=document.getElementById('pay-pop');
  pp.style.display='flex';
  const bl=pp.querySelector('.mbg-bl');
  gsap.fromTo(bl,{background:'rgba(0,0,0,0)',backdropFilter:'blur(0px)'},
    {background:'rgba(0,0,0,.4)',backdropFilter:'blur(14px)',duration:.28});
  gsap.fromTo('.pay-card',{scale:.88,y:22,opacity:0},{scale:1,y:0,opacity:1,duration:.34,ease:'back.out(1.4)'});
  pp.classList.add('open');
}
function closePayPop(e){
  if(e.target===document.getElementById('pay-pop')||e.target.classList.contains('mbg-bl'))closePayPopNow();
}
function closePayPopNow(){
  const pp=document.getElementById('pay-pop');
  gsap.to('.pay-card',{scale:.9,y:16,opacity:0,duration:.2,ease:'power2.in',onComplete:()=>{pp.style.display='none';pp.classList.remove('open');}});
}
function copyPayCmd(){
  const cmd=document.getElementById('pay-cmd').dataset.cmd;
  navigator.clipboard.writeText(cmd).then(()=>{
    const el=document.getElementById('pay-cmd');
    const orig=el.innerHTML;
    el.innerHTML='‚úÖ Copied!';
    setTimeout(()=>{el.innerHTML=orig},1500);
  });
}

/* ‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê */
function renderAdminEntries(){
  const entries=getLocalSpawnerEntries();
  const list=document.getElementById('pe-list');
  if(!entries.length){list.innerHTML='<div style="color:var(--t3);font-size:.78rem;padding:8px 0">No manual entries yet. Add prices below.</div>';return;}
  list.innerHTML=entries.map((e,i)=>`
    <div class="pe-row">
      <div class="pe-date">${e.date}</div>
      <div class="pe-price">${fmtP(e.price)}</div>
      <div class="pe-del" onclick="delPriceEntry(${i})">‚úï</div>
    </div>`).join('');
}
function addPriceEntry(){
  const d=document.getElementById('pe-date').value;
  const p=+document.getElementById('pe-price').value;
  if(!d||!p||p<=0){alert('Enter a valid date and price');return;}
  const entries=getLocalSpawnerEntries();
  entries.push({date:d,price:p});
  entries.sort((a,b)=>new Date(a.date)-new Date(b.date));
  saveSpawnerHistory(entries);
  document.getElementById('pe-price').value='';
  renderAdminEntries();
  buildMaps(); render();
}
function delPriceEntry(i){
  const entries=getLocalSpawnerEntries();
  entries.splice(i,1);saveSpawnerHistory(entries);
  renderAdminEntries();buildMaps();render();
}
function exportPrices(){
  const txt=JSON.stringify(getLocalSpawnerEntries(),null,2);
  navigator.clipboard.writeText(txt).then(()=>alert('JSON copied to clipboard!'));
}
function importPrices(){
  const txt=prompt('Paste JSON array of {date,price} objects:');
  if(!txt)return;
  try{
    const arr=JSON.parse(txt);
    if(!Array.isArray(arr))throw new Error();
    saveSpawnerHistory(arr);renderAdminEntries();buildMaps();render();
    alert(`Imported ${arr.length} entries!`);
  }catch(e){alert('Invalid JSON format');}
}
// Pre-fill date
function openAdmin(){
  const today=new Date().toISOString().split('T')[0];
  document.getElementById('pe-date').value=today;
  renderAdminEntries();
  const p=document.getElementById('admin-panel');
  p.style.display='flex';
  gsap.fromTo('.admin-box',{scale:.9,y:22,opacity:0},{scale:1,y:0,opacity:1,duration:.34,ease:'back.out(1.4)'});
  p.classList.add('open');
}
function closeAdmin(){
  const p=document.getElementById('admin-panel');
  gsap.to('.admin-box',{scale:.92,y:16,opacity:0,duration:.22,ease:'power2.in',
    onComplete:()=>{p.style.display='none';p.classList.remove('open');}});
}

/* ‚ïê‚ïê SEARCH ‚ïê‚ïê */
let sT;
document.getElementById('srch').addEventListener('input',e=>{
  clearTimeout(sT);sT=setTimeout(()=>{searchQ=e.target.value;render();},180);
});

/* ‚ïê‚ïê ENTRANCE ‚ïê‚ïê */
function animEntrance(){
  gsap.registerPlugin(ScrollTrigger);
  gsap.set(['#nav','.hero','.content'],{opacity:0,y:-10});
  gsap.set('.orb',{opacity:0});
  const tl=gsap.timeline({delay:.05});
  tl.to('.orb',{opacity:1,duration:1.4,stagger:.18,ease:'power1.out'})
    .to('#nav',{opacity:1,y:0,duration:.55,ease:'power3.out'},'-=.9')
    .to('.hero',{opacity:1,y:0,duration:.5,ease:'power2.out'},'-=.4')
    .fromTo('.hero-title',{y:26,opacity:0},{y:0,opacity:1,duration:.65,ease:'back.out(1.4)'},'<')
    .to('.content',{opacity:1,y:0,duration:.4},'-=.25');
}

/* ‚ïê‚ïê LOGOS ‚ïê‚ïê */
function setLogos(){
  const s=iSrc('elytra');
  document.getElementById('nav-logo').src=s;
  document.getElementById('ldr-img').src=s;
}

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
(async()=>{
  setLogos();
  document.getElementById('ltxt').textContent='Fetching orders‚Ä¶';
  await fetchOrders();
  document.getElementById('ltxt').textContent='Fetching auctions‚Ä¶';
  await fetchAuctions();
  buildMaps();
  document.getElementById('ltxt').textContent='Rendering‚Ä¶';
  render();
  animEntrance();
  gsap.to('#ldr',{opacity:0,duration:.5,delay:.5,ease:'power2.in',onComplete:()=>document.getElementById('ldr').remove()});
})();
</script>
</body>
</html>
